## 服务监听

服务监听使用Spring标准ApplicationEvent方式。

```java
public  class  PersistEvent  extends  ApplicationEvent {
  public  static  final  String  PRE_STORE = "pre_store";
  public  static  final  String  POST_STORE = "post_store";
  public  static  final  String  PRE_DELETE = "pre_delete";
  public  static  final  String  POST_DELETE = "post_delete";
  public  static  final  String  UPDATE = "update";
  public  static  final  String  ELASTIC = "elastic";

  public  static  final  String  ELASTIC_DELETE = "elastic_delete";
  private  final  String  eventType;
  private  Object  eventTarget;
}
```
客制化Event定制，生成自己的Event类，定义信号名称。如果上图所示。

### 推送信号
```java
/**
* 推送信号
*
* @param  eventTarget
* @param  eventType
*/
@Override
public  void  publishPersistEvent(Object eventTarget, String eventType) {
  if (Objects.isNull(eventPublisher)){
    return;
  }
  PersistEvent  event = new  PersistEvent(eventTarget, eventType);
  eventPublisher.publishEvent(event);
}
```
使用Spring的ApplicationEventPublisher,推送事件。

### 事件监听
```java
@Component
public  class  DocumentListener  implements  ApplicationListener {
  @Override
  public  void  onApplicationEvent(PersistEvent  event) {
    if (StringUtils.equalsIgnoreCase(event.getEventType(), PersistEvent.POST_CHECKOUT)) {
      log.debug("enter listener ...");
      Object  target = event.getEventTarget();
      log.debug("target:"+target);
      if ((target instanceof DocumentIfc)) {
        DocumentIfc  t = (DocumentIfc) target;
        DocumentIfc  orig = versionService.originOf(t);
        log.debug("orig:{} t:{}",orig,t);
        handle(orig, t);
      }
    }
  }
}
```